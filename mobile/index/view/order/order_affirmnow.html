<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta http-equiv="X-UA-Compatible" content="ie=edge">    <title>确认订单</title>    <link rel="stylesheet" href="/public/qdd/css/qrdd.css">    <script src="<?php echo CSS_PATH;?>mobile/js/jquery-1.9.1.min.js"></script>    <script src="<?php echo CSS_PATH;?>mobile/js/angular.min.js"></script>    <script type="text/javascript" src="<?php echo CSS_PATH;?>lib/layer/2.1/layer.js"></script></head><body ng-app="orderApp" ng-controller="orderCtrl" ng-cloak><header>    <a href="javascript:history.back(-1);" id="qrddfh">        <img src="/public/qdd/img/juxing.png" alt="">    </a>    <p>确认订单</p></header><form method="post" id="form-cart-settl">    <section>        <div class="shrBox" onclick="javascript:location.href='/mobile.php/member/address_list?return=nowbuy&proid={$Request.param.proid}&styleid={$Request.param.styleid}&pronum={$Request.param.pronum}';">            <div class="shr">                <a href="">                    <img src="/public/qdd/img/dingwei.png" alt="">                    <?php    if(isset($_GET['address'])){?>                    <div style="width: 260px;height: 90px;">                        <p style="margin-top:12px;">收货人：{$Think.get.receivename}<span>{$Think.get.mobile}</span></p>                        <p>收货地址：{$Think.get.address}</p>                        <input type="hidden" name="addres" value="{$Think.get.id}">                    </div>                    <?php    }else{    ?>                    <div ng-if="addresslist.isdefault=='1'" style="width: 260px;height: 90px;">                        <p style="margin-top:12px;">收货人：{{addresslist.receivename}}<span>{{addresslist.mobile}}</span></p>                        <p>收货地址：{{addresslist.address}}</p>                        <input type="hidden" name="addres" value="{{addresslist.id}}">                    </div>                    <div ng-if="addresslist.isdefault=='0'" style="width: 260px;height: 90px;">                        <p  style="line-height: 90px;">请选择收货地址</p>                    </div>                    <?php    }?>                    <img src="/public/qdd/img/you.png" alt="">                </a>            </div>            <img src="/public/qdd/img/submit-order-bg.png" alt="" id="bk">        </div>    <div class="qrddxq">        <div class="qrddxqTit">            <img src="/public/qdd/img/xiangjiaruzhu.png" alt="">            <p>{{suplist.suppliername}}</p>        </div>        <div class="qrddxqBox" ng-repeat="v in suplist.voo">            <img src="{{v.img}}" alt="" style="width:100px;height:98px;">            <div>                <p>{{v.proname}}</p>                <span>规格：{{v.stylename}}</span>                <p><strong>￥ {{v.shopprice}}</strong><span>X {{goods_num}}</span></p>            </div>        </div>    </div>    <div class="psfs">        <div class="psfsTit">            <p>配送方式</p>            <span>快递</span>        </div>        <div class="kdxz">            <div class="sf" ng-repeat="vi in suplist.deliverytype">                <label for="fteght_{{vi.id}}">{{vi.name}}</label>                 <input id="fteght_{{vi.id}}" value="{{vi.id}} " style="margin-left: 10px;width: 15px;height: 15px;"   type="radio" name="shipping_method_{{suplist.supplierid}}" ng-click="frieghts($event)" >                <!--<img src="/public/qdd/img/tuoyuan2.png" alt="" ng-click="frieghts($event)">-->            </div>            <!---->            <!--<div class="st">-->            <!--<span>申通</span>-->            <!--<img src="/public/qdd/img/tuoyuan3.png" alt="">-->            <!--</div>-->        </div>        <div class="kdf" id="yunfei_{{suplist.supplierid}}" style="display: none">        </div>        <div class="ddbz">            <span>订单备注</span>            <input type="text" name="remarks_{{suplist.supplierid}}" placeholder="（限50字以内）">            <span class="js">0/50</span>        </div>    </div>        <div class="spje" style="background: white;margin-bottom: 50px;width: 100%;height: 40px;">            <p>商品金额</p>            <span>￥{{sum_money}}</span>        </div>    </section>    <footer>        <p>￥<span id="gongji">{{sum_money}}</span></p>        <a href="#" id="ordersubmit">提交订单</a>    </footer></form></body></html><script type="text/javascript">    $('img').error(function() {        $(this).attr('src', "/public/Public/mobile/img/logo.png");    });    var app = angular.module('orderApp', []);    app.controller('orderCtrl', function($scope, $http) {        $http.get("/api.php/order/affirmnow?proid={$Request.param.proid}&styleid={$Request.param.styleid}&pronum={$Request.param.pronum}")            .success(function (response) {                if(response.status==1){                    $scope.suplist = response.data.suplist;                    $scope.addresslist = response.data.addresslist;                    $scope.username = response.data.username;                    $scope.sum_money = response.data.sum_money;                    $scope.sum_integral = response.data.sum_integral;                    $scope.sum_giveintegral = response.data.sum_giveintegral;                    $scope.goods_num = response.data.goods_num;                    $scope.is_show = response.data.is_show;                }else{                    layer.msg(response.msg,{icon:1,time:2000},function(){                        location.href=window.history.back(-1);                    });                }            });        $scope.frieghts = function(event){            var value=event.target.getAttribute('value');            var radioname=event.target.getAttribute('name');            var radionamearr=radioname.split("_");            var supplierid=radionamearr[2];            var addresid=$('input[name="addres"]').val();            if(addresid){                $.ajax({                    type: "post",                    url: "/api.php/index/index/getfrieght",                    data:'id='+value+'&supplierid='+supplierid+'&addresid='+addresid+'&type=2&prosum='+ $scope.goods_num+'&proid={$Request.param.proid}',                    dataType: "json",                    timeout: 2000,                    success:function (data) {                        if(data.status==0){                            $('#yunfei_'+supplierid).empty();                            $('#yunfei_'+supplierid).append('&nbsp;&nbsp;&nbsp;&nbsp;运费:<span id="yun_'+supplierid+'" style="margin-top: 0.1rem;">'+data.fright+'</span>');                            var yun=$('#yun_'+supplierid).text();                            $('#yunfei_'+supplierid).css('display','block');                            var totlemoney=parseInt(yun)+parseInt($scope.sum_money);                            $('#gongji').text(totlemoney);                        }else{                            $('#yunfei_'+supplierid).empty();                            var yun=$('#yun_'+val).text();                            $('#yunfei_'+supplierid).css('display','none');                            var totlemoney=parseInt(yun)+parseInt($scope.sum_money);                            $('#gongji').text(totlemoney);                            layer.msg(data.msg);                        }                    }                });            }else{                layer.msg('请选择收货地址');                $('#fteght_'+value).removeAttr('checked');                return;            }        };    });    /*-添加*/    $(function(){        $('#ordersubmit').click(function(){            var form=new FormData(document.getElementById("form-cart-settl"));            $.ajax({                url: '/api.php/order/generatenow?proid={$Request.param.proid}&styleid={$Request.param.styleid}&pronum={$Request.param.pronum}',                type: "post",                dataType:"json",                data:form,                async: false,                cache: false,                contentType: false,                processData: false,                success: function (rep) {                    if(rep.status==1){                        layer.msg(rep.msg,{icon:1,time:2000},function(){                            location.href=rep.data.url;                        });                    }else if(rep.status==2){                        layer.msg(rep.msg,{icon:1,time:2000},function(){                            location.href='/mobile.php/order/pay?ordertype=outer&orderno='+rep.data.orderno;                        });                    }else{                        layer.msg(rep.msg);                    }                }            });        });    });</script>